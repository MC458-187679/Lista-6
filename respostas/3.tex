\begin{theorem}[subestrutura ótima]
    Seja $n$ um inteiro com representação mínima $\langle t_0, t_1, \ldots, t_k \rangle$, sendo $k > 0$. Então, $\langle t_1, \ldots, t_k \rangle$ é uma representação mínima de $\dfrac{n - t_0}{3}$.
\end{theorem}

\begin{proof}[\textbf{Demonstração}]
    Considere $m = (n - t_0) / 3$ e sua representação mínima $R = \langle r_0, r_1, \ldots, r_{l^*} \rangle$ de tamanho $l^*$. Suponha agora uma representação $S = \langle s_0, \ldots, s_l \rangle$ de $m$ que não é ótima, isto é, $l > l^*$. Assim, temos que:
    \begin{align*}
        n &= 3 m + t_0 \\
        &= t_0 + 3 \left(r_0 + r_1 \cdot 3 + \cdots + r_{l^*} \cdot 3^l\right) \\
        &= t_0 + r_0 \cdot 3 + r_1 \cdot 3^2 + \cdots + r_{l^*} \cdot 3^{l^*+1}
    \end{align*}
    Então, temos a representação $R' = \langle t_0, r_0, \ldots, r_{l^*} \rangle$ para $n$. Da mesma forma, temos que $S' = \langle t_0, s_0, \ldots, s_l \rangle$ representando o mesmo número. Entretanto,
    \[
        \abs{R'} = \abs{R} + 1 = l^* + 2 < l + 2 = \abs{S} + 1 = \abs{S'}
    \]

    Ou seja, a representação $S'$ não é ótima. Portanto, pela contrapositiva, para qualquer representação $A$ de $n$, se ela for mínima, $A - \langle t_0 \rangle$ será uma representação mínima de $m$. Como $\langle t_0, t_1, \ldots, t_k \rangle$ é ótima, o teorema segue.
\end{proof}

\begin{theorem}[escolha gulosa]
    Seja $\langle t_0, \ldots, t_k \rangle$ uma representação mínima de $n$. Então, o primeiro dígito é $t_0 = (n + 1) \bmod 3 - 1$.
\end{theorem}

\begin{proof}
    Seja $r = (n + 1) \bmod 3 - 1$ e note que
    \[
        n - t_0 = \sum_{i = 0}^k t_i \cdot 3^i - t_0 = 3 \left(\sum_{i = 1}^k t_i \cdot 3^{i-1} \right)
    \]
    Como $t_i \in \integer$ e $3^{i - 1} \in \integer$ para $i > 0$, então $n - t_0 \equiv 0 \dmod{3}$. Portanto, $n \equiv t_0 \dmod{3}$.

    ~

    \begin{casos}
        \item $n \equiv 0 \dmod{3}$. Então, $(n + 1) \equiv 1 \dmod{3}$ e $r = 0$. Como $-1 \not\equiv 0 \dmod{3}$ e $1 \not\equiv 0 \dmod{3}$, temos que $t_0 = 0 = r$.
        \item $n \equiv 1 \dmod{3}$. De forma similar, temos que $t_0 = 1 = r$.
        \item $n \equiv 2 \dmod{3}$. Note que $(n + 1) \equiv 0 \dmod{3}$, então $r = -1 = t_0$.
    \end{casos}
\end{proof}

\begin{codebox}
    \Procname{$\proc{Mínimo-Dígitos}(n)$}
    \li \kw{se} $n \leq 1$ \kw{então}
        \Do
    \li     \kw{retorna} $(0, \langle n\rangle)$
        \End
    \li \kw{senão}
        \Do
    \li     $t_0 \gets ((n + 1) \bmod 3) - 1$
    \li     $(k, T) \gets \proc{Mínimo-Dígitos}((n - t_0) / 3)$
    \li     $T \gets \proc{Concatena}(\langle t_0\rangle, T)$
    \li     \kw{retorna} $(k + 1, T)$
        \End
\end{codebox}

Supondo a operação de concatenação é constante (como em listas ligadas), então a complexidade de tempo pode ser dada por:
\begin{align*}
    T(0) &= T(1) = a_1 > 0 \\
    T(n) &= T\left(\frac{n - (n + 1) \bmod 3 + 1}{3}\right) + \Theta(1) \leq T\left(\frac{n + 1}{3}\right) + a_2
\end{align*}

Note que $T(n) \leq c \lg n$ para $c = a_1 + a_2$ e $n \geq 2$. Dado que $T(2) = T(3) = T(4) = a_1 + a_2 = c \lg 2$ e, se $T(k) \leq c \lg k$, temos que
\begin{align*}
    T(n) &\leq T\left(\frac{n + 1}{3}\right) + a_2 \\
    &\leq c \lg \left(\frac{n + 1}{3}\right) + a_2 \\
    &\leq c \lg \frac{n}{2} + a_2 \\
    &= c \lg n - c + a_2 \\
    &\leq c \lg n
\end{align*}

Por outro lado, como $T(n) \geq T((n - 1) / 3) + a_2$, podemos mostrar de forma similar que $T(n) \geq d \lg n$, quando $d \leq (a_1 + a_2) / 2$ e $n \geq 2$. Portanto, $T(n) \in \Theta(\lg n)$. Pelas chamadas revursivas e pelo armazenamento do resultado, a complexidade de espaço também é $\Theta(\lg n)$.
